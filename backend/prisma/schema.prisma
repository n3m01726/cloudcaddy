// backend/prisma/schema.prisma

// Schéma de base de données pour le Multi-Cloud Manager

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "darwin"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}


model FileMetadata {
  id          String   @id @default(cuid())
  userId      String
  fileId      String
  cloudType   String   // 'google_drive' ou 'dropbox'
  
  // Tags et leurs couleurs
  tags        String?  // JSON array: ["tag1", "tag2"]
  tagColors   String?  // ⚠️ AJOUT IMPORTANT - JSON object: {"tag1": "red", "tag2": "blue"}
  
  // Métadonnées personnalisées
  customName  String?
  description String?  
  starred     Boolean  @default(false)
  color       String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Index composé unique pour éviter les doublons
  @@unique([userId, fileId, cloudType], name: "userId_fileId_cloudType")
  @@index([userId])
  @@index([starred])
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  emailVerified DateTime?
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  cloudAccounts CloudAccount[]
}

model CloudAccount {
  id           String   @id @default(cuid())
  email        String?
  userId       String
  provider     String   // 'google_drive' ou 'dropbox'
  accessToken  String   
  refreshToken String?  
  expiresAt    DateTime?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([userId, provider], name: "userId_provider")
}